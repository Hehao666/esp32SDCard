var M5=M5||{};M5.log=function(a){window.console&&console.log(a)};M5.Utils={};M5.Utils.getRelativePos=function(a,b){var c=M5.App.currentWidth,e=M5.App.currentHeight,d=0,f=0,d=a-GAME.canvas.offsetLeft-GAME.canvas.clientLeft,f=b-GAME.canvas.offsetTop-GAME.canvas.clientTop,d=~~(d/M5.App.SCALE),f=~~(f/M5.App.SCALE),d=c^(d^c)&-(d<c),f=e^(f^e)&-(f<e);return{x:0^(0^d)&-(0<d),y:0^(0^f)&-(0<f)}};M5.Utils.resolveRelativePositionFromEvent=function(a){var b;null===a?b=a=-1:a.changedTouches?(b=a.changedTouches[0].pageX,a=a.changedTouches[0].pageY):(b=a.pageX,a=a.pageY);return M5.Utils.getRelativePos(b,a)};M5.Button=function(a,b,c,e,d,f,g){this.ctx=a;this.sX=b;this.sY=c;this.eX=b+e.width;this.eY=c+e.height;this.imgNormal=e;this.imgDown=d;this.imgInactive=g;this.state=M5.Button.STATE_NORMAL;this.stateImg=this.imgNormal;this.action=f};M5.Button.STATE_NORMAL=0;M5.Button.STATE_DOWN=1;M5.Button.STATE_INACTIVE=2;M5.Button.prototype.draw=function(){this.ctx.drawImage(this.stateImg,this.sX,this.sY)};M5.Button.prototype.onDown=function(a,b){this.state!=M5.Button.STATE_INACTIVE&&this.isHit(a,b)&&(this.stateImg=this.imgDown,this.state=M5.Button.STATE_DOWN,this.draw())};M5.Button.prototype.onUp=function(a,b){this.state!=M5.Button.STATE_INACTIVE&&(M5.Button.STATE_DOWN===this.state&&this.isHit(a,b)&&this.trigger(),this.stateImg=this.imgNormal,this.state=M5.Button.STATE_NORMAL,this.draw())};M5.Button.prototype.disable=function(){this.state=M5.Button.STATE_INACTIVE;this.stateImg=this.imgInactive};M5.Button.prototype.enable=function(){this.state=M5.Button.STATE_NORMAL;this.stateImg=this.imgNormal};M5.Button.prototype.trigger=function(){"function"===typeof this.action&&this.state!=M5.Button.STATE_INACTIVE&&this.action()};M5.Button.prototype.isHit=function(a,b){return this.sX<a&&this.eX>a&&this.sY<b&&this.eY>b};M5.BitmapAnim=function(a){this._cellWidth=a.cellWidth||16;this._cellHeight=a.cellHeight||16;this._image=a.image||null;this._anims=a.anims||{};this._sequence=a.sequence||[];this._frameTime=this._seqPointer=0};M5.BitmapAnim.prototype.animate=function(a){this._frameTime+=a;this._sequence[this._seqPointer+1]<this._frameTime&&(this._seqPointer+=2,this._sequence.length<=this._seqPointer&&(this._seqPointer=0),this._frameTime=0)};M5.BitmapAnim.prototype.setSequence=function(a){return this._anims[a]?(this._sequence=this._anims[a],this._seqPointer=0,!0):!1};M5.BitmapAnim.prototype.draw=function(a,b,c){a.drawImage(this._image,this._sequence[this._seqPointer]*this._cellWidth,0,this._cellWidth,this._cellHeight,b,c,this._cellWidth,this._cellHeight)};M5.Scene=function(){this.update=function(){};this.render=function(){};this.onEnter=function(){};this.onExit=function(){}};M5.World={scenes:[],currentScene:null,update:function(a){this.currentScene&&this.currentScene.update(a)},render:function(){this.currentScene&&this.currentScene.render()},addScene:function(a){var b=this.scenes.length;a.id=b;this.scenes[b]=a;return b},removeScene:function(a){return this.scenes[a]?(this.scenes[a]=null,!0):!1},showScene:function(a){return this.scenes[a]?(this.currentScene&&this.currentScene.onExit(),this.currentScene=this.scenes[a],this.currentScene.onEnter(),this.currentScene.repaint(),!0):!1},resizeScene:function(a){this.currentScene&&this.currentScene.repaint(a)}};M5.App={WIDTH:0,HEIGHT:0,RATIO:0,SCALE:1,OFFSET:{top:0,left:0},currentWidth:0,currentHeight:0,FAST_CLICK:window.ontouch?"touchstart":"click",TOUCH_START:"ontouchstart"in document.documentElement?"touchstart":"mousedown",TOUCH_END:"ontouchstart"in document.documentElement?"touchend":"mouseup",TOUCH_MOVE:"ontouchstart"in document.documentElement?"touchmove":"mousemove",DEVICE_UA:navigator.userAgent.toLowerCase(),DEVICE_IS_ANDROID:-1<navigator.userAgent.toLowerCase().indexOf("android")?!0:!1,DEVICE_IS_IOS:-1<navigator.userAgent.toLowerCase().indexOf("iphone")||-1<navigator.userAgent.toLowerCase().indexOf("ipad")?!0:!1,_isInitialized:!1,_isStopped:!0,_isRunning:!1,_loopTimeout:null,_lastUpdate:null,_resizeFn:null,_loop:function(){var a=M5.App;if(a._isRunning){var b=(new Date).getTime()-a._lastUpdate;a._lastUpdate=(new Date).getTime();M5.World.update(b);a._loopTimeout=requestAnimationFrame(a._loop)}else
cancelAnimationFrame(a._loopTimeout)},init:function(a){this.WIDTH=a&&a.width||320;this.HEIGHT=a&&a.height||420;this.RATIO=this.WIDTH/this.HEIGHT;this._resizeFn=a&&a.resizeFn||null;"function"==typeof this._resizeFn&&(this._resizeFn(),window.addEventListener("resize",function(a){M5.App.resize(a)},!1));window.addEventListener("orientationchange",M5.App.onOrientationChange,!1);this._isInitialized=!0;return this},resize:function(a){"function"==typeof this._resizeFn&&this._resizeFn(a)},run:function(){if(!this._isInitialized)
throw Error("M5.App needs to be initialized first. Call M5.App.init() to do so.");this._isStopped=!1;this._isRunning=!0;this._lastUpdate=(new Date).getTime();this._loop()},stop:function(){this._isStopped=!0;this._isRunning=!1},getMouseX:function(a){var b=-1;a&&a.target&&(b=a.pageX-a.target.offsetLeft-a.target.clientLeft);return b},getMouseY:function(a){var b=-1;a&&a.target&&(b=a.pageY-a.target.offsetTop-a.target.clientTop);return b},onOrientationChange:function(){MBP.hideUrlBar()},getVendorPrefix:function(a){function b(a,b){return b.toUpperCase()}
var c=document.createElement("div"),e=["Khtml","Moz","Webkit","O","ms"],d;for(d=e.length-1;0<=d;d--)
if(((e[d]?e[d]+"-":"")+a).replace(/\-(\w)/g,b)in c.style)
return e[d]?"-"+e[d].toLowerCase()+"-":"";return null}};(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)
window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"RequestCancelAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),f=Math.max(0,16-(c-a)),g=window.setTimeout(function(){b(c+f)},f);a=c+f;return g});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();(function(a){window.MBP=window.MBP||{};MBP.viewportmeta=a.querySelector&&a.querySelector('meta[name="viewport"]');MBP.ua=navigator.userAgent;MBP.scaleFix=function(){MBP.viewportmeta&&/iPhone|iPad/.test(MBP.ua)&&!/Opera Mini/.test(MBP.ua)&&(MBP.viewportmeta.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0",a.addEventListener("gesturestart",MBP.gestureStart,!1))};MBP.gestureStart=function(){MBP.viewportmeta.content="width=device-width, minimum-scale=0.25, maximum-scale=1.6"};MBP.hideUrlBar=function(){/iPhone/.test(MBP.ua)&&!location.hash&&setTimeout(function(){pageYOffset||window.scrollTo(0,1)},1E3)};MBP.fastButton=function(a,c){this.element=a;this.handler=c;a.addEventListener&&(a.addEventListener("touchstart",this,!1),a.addEventListener("click",this,!1))};MBP.fastButton.prototype.handleEvent=function(a){switch(a.type){case"touchstart":this.onTouchStart(a);break;case"touchmove":this.onTouchMove(a);break;case"touchend":this.onClick(a);break;case"click":this.onClick(a)}};MBP.fastButton.prototype.onTouchStart=function(b){b.stopPropagation();this.element.addEventListener("touchend",this,!1);a.body.addEventListener("touchmove",this,!1);this.startX=b.touches[0].clientX;this.startY=b.touches[0].clientY;this.element.style.backgroundColor="rgba(0,0,0,.7)"};MBP.fastButton.prototype.onTouchMove=function(a){(10<Math.abs(a.touches[0].clientX-this.startX)||10<Math.abs(a.touches[0].clientY-this.startY))&&this.reset()};MBP.fastButton.prototype.onClick=function(a){a.stopPropagation();this.reset();this.handler(a);"touchend"==a.type&&MBP.preventGhostClick(this.startX,this.startY);this.element.style.backgroundColor=""};MBP.fastButton.prototype.reset=function(){this.element.removeEventListener("touchend",this,!1);a.body.removeEventListener("touchmove",this,!1);this.element.style.backgroundColor=""};MBP.preventGhostClick=function(a,c){MBP.coords.push(a,c);window.setTimeout(function(){MBP.coords.splice(0,2)},2500)};MBP.ghostClickHandler=function(a){for(var c=0,e=MBP.coords.length;c<e;c+=2){var d=MBP.coords[c+1];25>Math.abs(a.clientX-
MBP.coords[c])&&25>Math.abs(a.clientY-d)&&(a.stopPropagation()/* ,a.preventDefault() */)}};a.addEventListener&&a.addEventListener("click",MBP.ghostClickHandler,!0);MBP.coords=[];MBP.splash=function(){a.write('<link rel="apple-touch-startup-image" href="/img/'+("iPad"===navigator.platform?"h/":"l/")+'splash.png" />')};MBP.autogrow=function(a,c){function e(){var a=this.scrollHeight;a>this.clientHeight&&(this.style.height=a+3*f+"px")}
var d=c?c:12,f=a.currentStyle?a.currentStyle.lineHeight:getComputedStyle(a,null).lineHeight,f=-1==f.indexOf("px")?d:parseInt(f,10);a.style.overflow="hidden";a.addEventListener?a.addEventListener("keyup",e,!1):a.attachEvent("onkeyup",e)}})(document);(function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function e(){!a&&this.init&&this.init.apply(this,arguments)}
var d=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)
f[g]="function"==typeof c[g]&&"function"==typeof d[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);this._super=c;return e}}
(g,c[g]):c[g];e.prototype=f;e.prototype.constructor=e;e.extend=arguments.callee;return e}})();var TouchE={SWIPE_UP:0,SWIPE_RIGHT:1,SWIPE_DOWN:2,SWIPE_LEFT:3,_fingerCount:0,_startX:0,_startY:0,_curX:0,_curY:0,_deltaX:0,_deltaY:0,_horzDiff:0,_vertDiff:0,_minLength:20,_swipeLength:0,_swipeAngle:null,_swipeDirection:null,lastSwipeInfo:null,touchStart:function(a){/* a.preventDefault(); */a.touches?(this._fingerCount=a.touches.length,1==this._fingerCount?(this._startX=a.touches[0].pageX,this._startY=a.touches[0].pageY):TouchE.touchCancel(a)):(this._fingerCount=1,this._startX=a.pageX,this._startY=a.pageY)},touchMove:function(a){a.preventDefault();a.touches?1==a.touches.length?(this._curX=a.touches[0].pageX,this._curY=a.touches[0].pageY):TouchE.touchCancel(a):(this._curX=a.pageX,this._curY=a.pageY)},touchEnd:function(a){a.preventDefault();if(1==this._fingerCount&&0!=this._curX)
if(this._swipeLength=Math.round(Math.sqrt(Math.pow(this._curX-this._startX,2)+Math.pow(this._curY-this._startY,2))),this._swipeLength>=this._minLength){this._caluculateAngle();this._determineSwipeDirection();var b={direction:this._swipeDirection,fingerCount:this._fingerCount,startPos:{x:this._startX,y:this._startY},endPos:{x:this._curX,y:this._curY},swipeLength:this._swipeLength};this._listenerFn&&this._listenerFn(b);TouchE.touchCancel(a);this.lastSwipeInfo=b}else
TouchE.touchCancel(a);else
TouchE.touchCancel(a)},touchCancel:function(){this._swipeLength=this._vertDiff=this._horzDiff=this._deltaY=this._deltaX=this._curY=this._curX=this._startY=this._startX=this._fingerCount=0;this.lastSwipeInfo=this._swipeDirection=this._swipeAngle=null},_caluculateAngle:function(){var a=this._startX-this._curX,b=this._curY-this._startY;Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(b,2)));a=Math.atan2(b,a);this._swipeAngle=Math.round(180*a/Math.PI);0>this._swipeAngle&&(this._swipeAngle=360-Math.abs(this._swipeAngle))},_determineSwipeDirection:function(){this._swipeDirection=45>=this._swipeAngle&&0<=this._swipeAngle?this.SWIPE_LEFT:360>=this._swipeAngle&&315<=this._swipeAngle?this.SWIPE_LEFT:135<=this._swipeAngle&&225>=this._swipeAngle?this.SWIPE_RIGHT:45<this._swipeAngle&&135>this._swipeAngle?this.SWIPE_DOWN:this.SWIPE_UP}};M5.G=M5.G||{};M5.G.BOARD_WIDTH=300;M5.G.BOARD_HEIGHT=300;M5.G.BOARD_DIM_X=3;M5.G.BOARD_DIM_Y=3;M5.G.BOARD_CELL_WIDTH=~~(M5.G.BOARD_WIDTH/M5.G.BOARD_DIM_X);M5.G.BOARD_CELL_HEIGHT=~~(M5.G.BOARD_HEIGHT/M5.G.BOARD_DIM_Y);M5.G.SWIPE_SPEED=500;M5.LevelManager={REPLAY_UP:0,REPLAY_RIGHT:1,REPLAY_DOWN:2,REPLAY_LEFT:3,currentLevel:-1,currentLevelObj:null,levels:[],cellGrid:null,unlockedLevels:store.get("com.backyart.picshift3d.unlockedLevels")||1,colors:[7514047,10663346,11379325,13281907,15430751,16434030],getImgDataForCell:function(a){var b;b=~~(a/M5.G.BOARD_DIM_X);a-=b*M5.G.BOARD_DIM_X;b*=M5.G.BOARD_CELL_WIDTH;a*=M5.G.BOARD_CELL_HEIGHT;return this.levels[this.currentLevel].context.getImageData(a,b,M5.G.BOARD_CELL_WIDTH,M5.G.BOARD_CELL_HEIGHT)},addLevel:function(a,b){this.levels[a]=b},setLevel:function(a){this.currentLevel=a-2;this.nextLevel()},nextLevel:function(){this.currentLevelObj&&this.currentLevelObj.destroy();this.currentLevel++; updateShareScore(this.currentLevel); if(this.levels.length<=this.currentLevel)
return!1;this.levels[this.currentLevel].init(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);this.levels[this.currentLevel].setup();this.currentLevelObj=this.levels[this.currentLevel];return!0},getCellGrid:function(){null===this.cellGrid&&(this.cellGrid=M5.G.am.getAsset("assets/cell_grid.png"));return this.cellGrid},getUnlockedLevels:function(){return this.unlockedLevels},unlockNextLevel:function(){var a=!1;this.currentLevel+2>this.unlockedLevels&&(store.set("com.backyart.picshift3d.unlockedLevels",Math.min(this.levels.length,this.currentLevel+2)),store.get("com.backyart.picshift3d.unlockedLevels")==this.levels.length&&(a=!0));this.unlockedLevels=store.get("com.backyart.picshift3d.unlockedLevels")||1;return a}};M5.Level=function(){this.cellGrid=this.context=this.canvas=null;this.init=function(a,b){this.canvas=document.createElement("canvas");this.canvas.setAttribute("width",a);this.canvas.setAttribute("height",b);this.context=this.canvas.getContext("2d");this.cellGrid=M5.LevelManager.getCellGrid()};this.setup=function(){};this.update=function(){};this.setSuccessState=function(){};this.destroy=function(){this.camera=this.scene=this.cube=this.renderer=null;this.cube2&&(this.cube2=null)}};var level1=new M5.Level;level1.camera=level1.scene=level1.cube=level1.renderer=null;level1.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:0,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube)};level1.setSuccessState=function(){};level1.replaySpeed=1E3;level1.replaySeq=[{d:0,r:1},{d:1,r:0}];level1.update=function(){this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(0,level1);var level2=new M5.Level;level2.camera=level2.scene=level2.cube=level2.renderer=null;level2.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:41,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube)};level2.setSuccessState=function(){};level2.replaySpeed=1E3;level2.replaySeq=[{d:0,r:1},{d:2,r:0},{d:2,r:2}];level2.update=function(){this.cube.rotation.y+=0.01;this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(1,level2);var level3=new M5.Level;level3.camera=level3.scene=level3.cube=level3.renderer=null;level3.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:82,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube)};level3.setSuccessState=function(){};level3.replaySpeed=1E3;level3.replaySeq=[{d:2,r:2},{d:2,r:0},{d:0,r:1},{d:1,r:1}];level3.update=function(){this.cube.rotation.y+=0.01;this.cube.rotation.x-=0.005;this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(2,level3);var level4=new M5.Level;level4.camera=level4.scene=level4.cube=level4.renderer=null;level4.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:123,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube);this.time=0};level4.setSuccessState=function(){};level4.replaySpeed=1E3;level4.replaySeq=[{d:0,r:0},{d:0,r:2},{d:2,r:1}];level4.update=function(a){this.time+=a;this.cube.rotation.y+=0.01;this.cube.rotation.x-=0.005;this.cube.position.y+=1*Math.sin(~~this.time/800);this.cube.position.x+=1*Math.cos(~~this.time/800);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(3,level4);var level5=new M5.Level;level5.camera=level5.scene=level5.cube=level5.renderer=null;level5.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:164,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube);this.time=0};level5.setSuccessState=function(){};level5.replaySpeed=800;level5.replaySeq=[{d:3,r:1},{d:1,r:0},{d:1,r:2},{d:1,r:2},{d:3,r:1},{d:1,r:0}];level5.update=function(a){this.time+=a;this.cube.rotation.y+=0.01;this.cube.rotation.x-=0.005;this.cube.position.y+=1*Math.sin(this.time/800);this.cube.position.x+=1*Math.cos(this.time/800);this.camera.position.z+=4*Math.sin(this.time/400);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(4,level5);var level6=new M5.Level;level6.camera=level6.scene=level6.cube=level6.renderer=null;level6.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:205,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube);this.time=0};level6.setSuccessState=function(){};level6.replaySpeed=800;level6.replaySeq=[{d:3,r:1},{d:1,r:0},{d:0,r:2},{d:1,r:2},{d:3,r:1},{d:0,r:0}];level6.update=function(a){this.time+=a;this.cube.rotation.y+=0.01;this.cube.rotation.x-=0.005;this.cube.position.y+=1*Math.sin(this.time/800);this.cube.position.x+=1*Math.cos(this.time/800);this.cube.scale.x=1+Math.cos(this.time/1E3);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(5,level6);var level7=new M5.Level;level7.camera=level7.scene=level7.cube=level7.renderer=null;level7.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:246,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=800;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube);this.time=0};level7.setSuccessState=function(){};level7.replaySpeed=800;level7.replaySeq=[{d:3,r:1},{d:1,r:0},{d:1,r:2},{d:1,r:2},{d:3,r:1},{d:0,r:2},{d:2,r:1},{d:1,r:0}];level7.update=function(a){this.time+=a;this.cube.rotation.y+=0.01;this.cube.rotation.x-=0.005;this.cube.position.y+=1*Math.sin(this.time/800);this.cube.position.x+=1*Math.cos(this.time/800);this.cube.scale.x=1+Math.cos(this.time/1E3);this.cube.scale.y=2+Math.sin(this.time/1E3);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(6,level7);var level8=new M5.Level;level8.camera=level8.scene=level8.cube=level8.renderer=null;level8.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:287,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0,side:THREE.DoubleSide});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube);this.time=0};level8.setSuccessState=function(){};level8.replaySpeed=700;level8.replaySeq=[{d:3,r:1},{d:0,r:1},{d:1,r:2},{d:1,r:2}];level8.update=function(a){this.time+=a;this.cube.rotation.y+=0.01;this.cube.rotation.x-=0.005;this.cube.position.y+=1*Math.sin(this.time/800);this.cube.position.x+=1*Math.cos(this.time/800);this.camera.position.z+=4*Math.sin(this.time/400);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(7,level8);var level9=new M5.Level;level9.camera=level9.scene=level9.cube=level9.renderer=null;level9.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:328,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(275,275,275),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0,side:THREE.DoubleSide});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.scene.add(this.cube);this.time=0};level9.setSuccessState=function(){};level9.replaySpeed=700;level9.replaySeq=[{d:3,r:1},{d:0,r:1},{d:1,r:2},{d:1,r:2},{d:3,r:1},{d:1,r:0}];level9.update=function(a){this.time+=a;this.cube.rotation.y+=0.02;this.cube.rotation.x-=0.01;this.cube.position.y+=1*Math.sin(this.time/800);this.cube.position.x+=1*Math.cos(this.time/800);this.camera.position.z+=4*Math.sin(this.time/400);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(8,level9);var level10=new M5.Level;level10.camera=level10.scene=level10.cube=level10.cube2=level10.renderer=null;level10.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:369,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(150,150,150),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0,side:THREE.DoubleSide});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.cube.position.x=-200;this.cube.position.y=-100;this.cube2=new THREE.Mesh(a,b);this.cube2.rotation.y=Math.PI/4;this.cube2.rotation.x=Math.PI/4;this.cube2.position.x=200;this.cube2.position.y=-100;this.scene.add(this.cube);this.scene.add(this.cube2);this.time=0};level10.setSuccessState=function(){};level10.replaySpeed=600;level10.replaySeq=[{d:3,r:1},{d:0,r:0},{d:3,r:1},{d:2,r:2},{d:1,r:0}];level10.update=function(a){this.time+=a;this.cube.rotation.y+=0.02;this.cube.rotation.x-=0.01;this.cube.position.y+=4*Math.sin(this.time/400);this.cube.position.x+=4*Math.cos(this.time/400);this.cube2.rotation.y-=0.02;this.cube2.rotation.x+=0.01;this.cube2.position.y+=4*Math.sin(this.time/400);this.cube2.position.x+=4*Math.cos(this.time/400);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(9,level10);level10=new M5.Level;level10.camera=level10.scene=level10.cube=level10.cube2=level10.renderer=null;level10.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:369,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(150,150,150),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0,side:THREE.DoubleSide});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.cube.position.x=-200;this.cube.position.y=-100;this.cube2=new THREE.Mesh(a,b);this.cube2.rotation.y=Math.PI/4;this.cube2.rotation.x=Math.PI/4;this.cube2.position.x=200;this.cube2.position.y=-100;this.scene.add(this.cube);this.scene.add(this.cube2);this.time=0};level10.setSuccessState=function(){};level10.replaySpeed=600;level10.replaySeq=[{d:3,r:1},{d:0,r:0},{d:3,r:1},{d:2,r:2},{d:1,r:0}];level10.update=function(a){this.time+=a;this.cube.rotation.y+=0.02;this.cube.rotation.x-=0.01;this.cube.position.y+=4*Math.sin(this.time/400);this.cube.position.x+=4*Math.cos(this.time/400);this.cube2.rotation.y-=0.02;this.cube2.rotation.x+=0.01;this.cube2.position.y+=4*Math.sin(this.time/400);this.cube2.position.x+=4*Math.cos(this.time/400);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(9,level10);var level11=new M5.Level;level11.camera=level11.scene=level11.cube=level11.cube2=level11.renderer=null;level11.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:410,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(150,150,150),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0,side:THREE.DoubleSide});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.cube.position.x=-200;this.cube.position.y=-100;this.cube2=new THREE.Mesh(a,b);this.cube2.rotation.y=Math.PI/4;this.cube2.rotation.x=Math.PI/4;this.cube2.position.x=200;this.cube2.position.y=-100;this.scene.add(this.cube);this.scene.add(this.cube2);this.time=0};level11.setSuccessState=function(){};level11.replaySpeed=500;level11.replaySeq=[{d:3,r:1},{d:0,r:0},{d:3,r:1},{d:2,r:2},{d:0,r:0},{d:1,r:0},{d:3,r:1},{d:3,r:2},{d:2,r:2},{d:1,r:0}];level11.update=function(a){this.time+=a;this.cube.rotation.y+=0.02;this.cube.rotation.x-=0.01;this.cube.position.y+=4*Math.sin(this.time/400);this.cube.position.x+=4*Math.cos(this.time/400);this.cube.scale.x=1+Math.cos(this.time/1E3);this.cube.scale.y=2+Math.sin(this.time/1E3);this.cube2.rotation.y-=0.02;this.cube2.rotation.x+=0.01;this.cube2.position.y-=4*Math.sin(this.time/400);this.cube2.position.x-=4*Math.cos(this.time/400);this.cube2.scale.x=1+Math.cos(this.time/500);this.cube2.scale.y=2+Math.sin(this.time/500);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(10,level11);var level12=new M5.Level;level12.camera=level2.scene=level12.cube=level12.cube2=level12.renderer=null;level12.setup=function(){this.label=M5.G.am.getAsset("assets/levelLabels.png",{x:0,y:451,w:188,h:41});this.camera=new THREE.PerspectiveCamera(75,M5.G.BOARD_WIDTH/M5.G.BOARD_HEIGHT,1,1E4);this.camera.position.y=0;this.camera.position.z=500;this.scene=new THREE.Scene;this.renderer=new THREE.CanvasRenderer({params:this.canvas,devicePixelRatio:1});this.renderer.setClearColorHex(2892581);this.renderer.setSize(M5.G.BOARD_WIDTH,M5.G.BOARD_HEIGHT);for(var a=new THREE.CubeGeometry(150,150,150),b=0;b<a.faces.length;b++)
a.faces[b].color.setHex(M5.LevelManager.colors[b]);b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0,side:THREE.DoubleSide});this.cube=new THREE.Mesh(a,b);this.cube.rotation.y=Math.PI/4;this.cube.rotation.x=Math.PI/4;this.cube.position.x=-200;this.cube.position.y=-100;this.cube2=new THREE.Mesh(a,b);this.cube2.rotation.y=Math.PI/4;this.cube2.rotation.x=Math.PI/4;this.cube2.position.x=200;this.cube2.position.y=-100;this.scene.add(this.cube);this.scene.add(this.cube2);this.time=0};level12.setSuccessState=function(){};level12.replaySpeed=300;level12.replaySeq=[{d:3,r:1},{d:0,r:0},{d:3,r:1},{d:2,r:2},{d:0,r:0},{d:1,r:0},{d:3,r:1},{d:3,r:2},{d:0,r:0},{d:3,r:1},{d:2,r:2},{d:0,r:0},{d:1,r:0},{d:3,r:1},{d:3,r:2},{d:2,r:2},{d:1,r:0}];level12.update=function(a){this.time+=a;this.cube.rotation.y+=0.02;this.cube.rotation.x-=0.01;this.cube.position.y+=4*Math.sin(this.time/400);this.cube.position.x+=4*Math.cos(this.time/400);this.cube.scale.x=1+Math.cos(this.time/1E3);this.cube.scale.y=2+Math.sin(this.time/1E3);this.cube2.rotation.y-=0.02;this.cube2.rotation.x+=0.01;this.cube2.position.y-=4*Math.sin(this.time/400);this.cube2.position.x-=4*Math.cos(this.time/400);this.cube2.scale.x=1+Math.cos(this.time/500);this.cube2.scale.y=2+Math.sin(this.time/500);this.renderer.render(this.scene,this.camera);this.context.drawImage(this.renderer.domElement,0,0);this.context.drawImage(this.cellGrid,0,0)};M5.LevelManager.addLevel(11,level12);function AssetManager(){this.errorCount=this.successCount=0;this.cache={};this.downloadQueue=[]}
AssetManager.prototype.queueDownload=function(a){this.downloadQueue.push(a)};AssetManager.prototype.downloadAll=function(a){0===this.downloadQueue.length&&a();for(var b=0;b<this.downloadQueue.length;b++){var c=this.downloadQueue[b],e=new Image,d=this;e.addEventListener("load",function(){d.successCount+=1;d.isDone()&&a()},!1);e.addEventListener("error",function(){d.errorCount+=1;d.isDone()&&a()},!1);e.src=c;this.cache[c]=e}};AssetManager.prototype.getAsset=function(a,b){if(b){var c=document.createElement("canvas");c.width=b.w;c.height=b.h;c.getContext("2d").drawImage(this.cache[a],b.x,b.y,b.w,b.h,0,0,b.w,b.h);return c}
return this.cache[a]};AssetManager.prototype.isDone=function(){return this.downloadQueue.length==this.successCount+this.errorCount};M5.Cell=function(a,b,c){this.color="#"+(16777216+16777215*Math.random()).toString(16).substr(1,6);this.id=a;this.x=b;this.y=c;this.rx=this.x*M5.G.BOARD_CELL_WIDTH;this.ry=this.y*M5.G.BOARD_CELL_HEIGHT;this.ly=~~(this.id/M5.G.BOARD_DIM_X);this.lx=this.id-this.ly*M5.G.BOARD_DIM_X;this.ly*=M5.G.BOARD_CELL_WIDTH;this.lx*=M5.G.BOARD_CELL_HEIGHT;this.onPositionChange()};M5.Cell.prototype.draw=function(a,b,c){b=this.rx+b;c=this.ry+c;a.drawImage(M5.LevelManager.currentLevelObj.canvas,this.lx,this.ly,M5.G.BOARD_CELL_WIDTH,M5.G.BOARD_CELL_HEIGHT,b,c,M5.G.BOARD_CELL_WIDTH,M5.G.BOARD_CELL_HEIGHT);0>c?(c=0>c?-c:c,a.drawImage(M5.LevelManager.currentLevelObj.canvas,this.lx,this.ly,M5.G.BOARD_CELL_WIDTH,c,b,M5.G.BOARD_HEIGHT-c,M5.G.BOARD_CELL_WIDTH,c)):c+M5.G.BOARD_CELL_HEIGHT>M5.G.BOARD_HEIGHT?(c=c+M5.G.BOARD_CELL_HEIGHT-M5.G.BOARD_HEIGHT,a.drawImage(M5.LevelManager.currentLevelObj.canvas,this.lx,this.ly+M5.G.BOARD_CELL_HEIGHT-c,M5.G.BOARD_CELL_WIDTH,c,b,0,M5.G.BOARD_CELL_WIDTH,c)):0>b?(b=0>b?-b:b,a.drawImage(M5.LevelManager.currentLevelObj.canvas,this.lx,this.ly,b,M5.G.BOARD_CELL_HEIGHT,M5.G.BOARD_WIDTH-b,c,b,M5.G.BOARD_CELL_HEIGHT)):b+M5.G.BOARD_CELL_WIDTH>M5.G.BOARD_WIDTH&&(b=b+M5.G.BOARD_CELL_WIDTH-M5.G.BOARD_WIDTH,a.drawImage(M5.LevelManager.currentLevelObj.canvas,this.lx+M5.G.BOARD_CELL_WIDTH-b,this.ly,b,M5.G.BOARD_CELL_HEIGHT,0,c,b,M5.G.BOARD_CELL_HEIGHT))};M5.Cell.prototype.onPositionChange=function(){0>this.x&&(this.x=2);2<this.x&&(this.x=0);0>this.y&&(this.y=2);2<this.y&&(this.y=0);this.rx=this.x*M5.G.BOARD_CELL_WIDTH;this.ry=this.y*M5.G.BOARD_CELL_HEIGHT};M5.Cell.prototype.moveUp=function(){this.y--;this.onPositionChange()};M5.Cell.prototype.moveDown=function(){this.y++;this.onPositionChange()};M5.Cell.prototype.moveLeft=function(){this.x--;this.onPositionChange()};M5.Cell.prototype.moveRight=function(){this.x++;this.onPositionChange()};var board=new M5.Scene;board.WIDTH=M5.G.BOARD_WIDTH;board.HEIGHT=M5.G.BOARD_HEIGHT;board.canvas=document.createElement("canvas");board.canvas.setAttribute("width",board.WIDTH);board.canvas.setAttribute("height",board.HEIGHT);board.context=board.canvas.getContext("2d");board.actors=[];board.cells=[];board.dx=[0,0,0];board.dy=[0,0,0];board.DIM_X=M5.G.BOARD_DIM_X;board.DIM_Y=M5.G.BOARD_DIM_Y;board.CELL_WIDTH=M5.G.BOARD_CELL_WIDTH;board.CELL_HEIGHT=M5.G.BOARD_CELL_HEIGHT;board.SWIPE_SPEED=M5.G.SWIPE_SPEED;board.isSwipeable=!1;board.isSwiping=!1;board.replayPointer=0;board.state=0;board.bgImg=null;board.stageFrameImg=null;board.btBack=null;board.labelMixing=null;board.labelSuper=null;board.labelCongratulations=null;board.activeLabel=null;board.isInitialized=!1;board.lastMoveEvent=null;board.SHOW_HIDE_DELAY=3E3;board.STATES={REPLAYING:0,WAITING:1,PROCESSING_INPUT:2};board.updateCellData=function(){for(var a=0,b=0,b=0;3>b;b++)
for(a=0;3>a;a++);};board.onEnter=function(){board.isSwipeable=!1;board.isSwiping=!1;board.replayPointer=0;board.state=0;board.activeLabel=null;for(var a=board.lastMoveEvent=null,b=0,c=0,c=0;3>c;c++)
for(b=0;3>b;b++)
a=new M5.Cell(b+3*c,b,c),this.cells[3*c+b]=a;this.dx=[0,0,0];this.dy=[0,0,0];this.isInitialized||(this.bgImg=M5.G.am.getAsset("assets/background.png"),this.stageFrameImg=M5.G.am.getAsset("assets/ingameFrame.png"),this.btBack=new M5.Button(GAME.context,84,340,M5.G.am.getAsset("assets/btBackNormal.png"),M5.G.am.getAsset("assets/btBackDown.png"),function(){board.state!=board.STATES.REPLAYING&&M5.World.showScene(select.id)},M5.G.am.getAsset("assets/btBackDisabled.png")),this.labelMixing=M5.G.am.getAsset("assets/labelMixing.png"),this.labelSuper=M5.G.am.getAsset("assets/labelSuper.png"),this.labelCongratulations=M5.G.am.getAsset("assets/labelCongratulations.png"),this.isInitialized=!0);board.labelTween.init(board.labelMixing.width);this.startReplay();GAME.CONTROL.onTouchStart=board.onTouchStart;GAME.CONTROL.onTouchMove=board.onTouchMove;GAME.CONTROL.onTouchEnd=board.onTouchEnd};board.onExit=function(){GAME.CONTROL.disableInput();TWEEN.removeAll()};board.repaint=function(){GAME.context.drawImage(this.bgImg,0,0,GAME.WIDTH,GAME.HEIGHT);board.btBack.draw()};board.startSwipe=function(a){board.isSwiping||(TouchE.touchStart(a),board.isSwiping=!0)};board.moveSwipe=function(a){board.isSwiping&&TouchE.touchMove(a)};board.stopSwipe=function(a){board.isSwiping=!1;TouchE.touchEnd(a);if(TouchE.lastSwipeInfo&&board.isSwipeable){board.isSwipeable=!1;this.state=board.STATES.PROCESSING_INPUT;var a=TouchE.lastSwipeInfo,b=M5.Utils.getRelativePos(a.startPos.x,a.startPos.y);switch(a.direction){case TouchE.SWIPE_UP:var c=~~(b.x/100),a=(new TWEEN.Tween({y:0})).to({y:-board.CELL_HEIGHT},board.SWIPE_SPEED).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dy[c]=this.y}).onComplete(function(){board.moveUp(c);board.dy[c]=0;board.onSwipeComplete()});a.start();break;case TouchE.SWIPE_DOWN:c=~~(b.x/100);a=(new TWEEN.Tween({y:0})).to({y:board.CELL_HEIGHT},board.SWIPE_SPEED).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dy[c]=this.y}).onComplete(function(){board.moveDown(c);board.dy[c]=0;board.onSwipeComplete()});a.start();break;case TouchE.SWIPE_LEFT:c=~~(b.y/100);a=(new TWEEN.Tween({x:0})).to({x:-board.CELL_WIDTH},board.SWIPE_SPEED).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dx[c]=this.x}).onComplete(function(){board.moveLeft(c);board.dx[c]=0;board.onSwipeComplete()});a.start();break;case TouchE.SWIPE_RIGHT:c=~~(b.y/100),a=(new TWEEN.Tween({x:0})).to({x:board.CELL_WIDTH},board.SWIPE_SPEED).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dx[c]=this.x}).onComplete(function(){board.moveRight(c);board.dx[c]=0;board.onSwipeComplete()}),a.start()}}};board.onSwipeComplete=function(){for(var a=0,b=0,c=0,c=0;3>c;c++)
for(b=0;3>b;b++)
if(this.cells[3*c+b].id==a)
a++;else
break;a==this.cells.length?(a=M5.LevelManager.unlockNextLevel(),M5.LevelManager.currentLevelObj.setSuccessState(),board.activeLabel=a?board.labelCongratulations:board.labelSuper,board.btBack.disable(),board.repaint(),board.labelTween.start(1200),setTimeout(function(){M5.LevelManager.nextLevel()?(board.replayPointer=0,board.startReplay()):M5.World.showScene(select.id)},board.SHOW_HIDE_DELAY)):(board.isSwipeable=!0,this.state=board.STATES.WAITING)};board.startReplay=function(){board.state=board.STATES.REPLAYING;board.btBack.disable();board.repaint();board.activeLabel=M5.LevelManager.currentLevelObj.label;board.labelTween.start(2E3);setTimeout(function(){board.replayPointer=0;board.activeLabel=board.labelMixing;board.labelTween.start(M5.LevelManager.currentLevelObj.replaySeq.length*M5.LevelManager.currentLevelObj.replaySpeed);setTimeout(board.replay,100)},board.SHOW_HIDE_DELAY)};board.replay=function(){var a=board,b=M5.LevelManager.currentLevelObj.replaySeq[a.replayPointer];a.replayStep(b.d,b.r,M5.LevelManager.currentLevelObj.replaySpeed)};board.onReplayStepComplete=function(){M5.LevelManager.currentLevelObj.replaySeq.length-1>this.replayPointer?(this.replayPointer++,this.replay()):(this.isSwipeable=!0,this.state=board.STATES.WAITING,board.btBack.enable(),board.repaint())};board.replayStep=function(a,b,c){switch(a){case TouchE.SWIPE_UP:a=(new TWEEN.Tween({y:0})).to({y:-board.CELL_HEIGHT},c).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dy[b]=this.y}).onComplete(function(){board.moveUp(b);board.dy[b]=0;board.onReplayStepComplete()});a.start();break;case TouchE.SWIPE_DOWN:a=(new TWEEN.Tween({y:0})).to({y:board.CELL_HEIGHT},c).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dy[b]=this.y}).onComplete(function(){board.moveDown(b);board.dy[b]=0;board.onReplayStepComplete()});a.start();break;case TouchE.SWIPE_LEFT:a=(new TWEEN.Tween({x:0})).to({x:-board.CELL_WIDTH},c).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dx[b]=this.x}).onComplete(function(){board.moveLeft(b);board.dx[b]=0;board.onReplayStepComplete()});a.start();break;case TouchE.SWIPE_RIGHT:a=(new TWEEN.Tween({x:0})).to({x:board.CELL_WIDTH},c).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.dx[b]=this.x}).onComplete(function(){board.moveRight(b);board.dx[b]=0;board.onReplayStepComplete()}),a.start()}};board.update=function(a){TWEEN.update();var b=0,c=0;M5.LevelManager.currentLevelObj.update(a);for(c=0;3>c;c++)
for(b=0;3>b;b++)
this.cells[3*c+b].draw(this.context,this.dx[c],this.dy[b]);this.activeLabel&&this.context.drawImage(this.activeLabel,board.labelTween.xPos,130);GAME.context.drawImage(this.canvas,10,19,board.WIDTH,board.HEIGHT);GAME.context.drawImage(this.stageFrameImg,0,0)};board.moveUp=function(a){var b,c;for(b=0;b<board.DIM_Y;b++)
this.cells[b*board.DIM_X+a].moveUp();c=this.cells[0+a];for(b=1;b<board.DIM_Y;b++)
this.cells[(b-1)*board.DIM_X+a]=this.cells[b*board.DIM_X+a];this.cells[(board.DIM_Y-1)*board.DIM_X+a]=c};board.moveDown=function(a){var b,c;for(b=0;b<board.DIM_Y;b++)
this.cells[b*board.DIM_X+a].moveDown();c=this.cells[(board.DIM_Y-1)*board.DIM_X+a];for(b=board.DIM_Y-1;0<b;b--)
this.cells[b*board.DIM_X+a]=this.cells[(b-1)*board.DIM_X+a];this.cells[0*board.DIM_X+a]=c};board.moveLeft=function(a){var b,c;for(b=0;b<board.DIM_X;b++)
this.cells[b+board.DIM_Y*a].moveLeft();c=this.cells[board.DIM_X*a];for(b=1;b<board.DIM_X;b++)
this.cells[b-1+board.DIM_Y*a]=this.cells[b+board.DIM_Y*a];this.cells[board.DIM_X-1+board.DIM_Y*a]=c};board.moveRight=function(a){var b,c;for(b=0;b<board.DIM_X;b++)
this.cells[b+board.DIM_Y*a].moveRight();c=this.cells[board.DIM_Y*a+(board.DIM_X-1)];for(b=board.DIM_X-1;0<b;b--)
this.cells[b+board.DIM_Y*a]=this.cells[b-1+board.DIM_Y*a];this.cells[board.DIM_X*a]=c};board.onTouchStart=function(a){var b;b=M5.Utils.resolveRelativePositionFromEvent(a);board.lastMoveEvent=a;if(325>b.y)
board.state==board.STATES.WAITING&&board.startSwipe(a);else
board.btBack.onDown(b.x,b.y)};board.onTouchMove=function(a){board.state==board.STATES.WAITING&&(board.lastMoveEvent=a,board.moveSwipe(a))};board.onTouchEnd=function(a){var b;b=M5.Utils.resolveRelativePositionFromEvent(board.lastMoveEvent);board.stopSwipe(a);board.btBack.onUp(b.x,b.y)};board.labelTween={xPos:-200,yPos:200,sxPos:0,dyPos:200,dxPos:0,dyPos:200,finXPos:0,finYPos:200,init:function(a){this.sxPos=GAME.WIDTH+a;this.dxPos=GAME.WIDTH/2-a/2-10|0;this.finXPos=-a},start:function(a){var b=(new TWEEN.Tween({x:board.labelTween.sxPos})).to({x:board.labelTween.dxPos},600).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){board.labelTween.xPos=this.x}).onComplete(function(){}),a=(new TWEEN.Tween({x:0})).to({x:1},Math.max(600,a-800)).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){}).onComplete(function(){});b.chain(a);var c=(new TWEEN.Tween({x:board.labelTween.dxPos})).to({x:board.labelTween.finXPos},600).easing(TWEEN.Easing.Quadratic.In).onUpdate(function(){board.labelTween.xPos=this.x}).onComplete(function(){board.activeLabel=null});a.chain(c);b.start()}};var select=new M5.Scene;select.imgBG=null;select.backBtn=null;select.isInitialized=!1;select.lastMoveEvent=null;select.LEVEL_TOTAL=12;select.btLevels=[];select.unlockedLevels=null;select.isLeavingScene=!1;select.onEnter=function(){select.isLeavingScene=!1;select.unlockedLevels=M5.LevelManager.getUnlockedLevels();select.imgBG=M5.G.am.getAsset("assets/background.png");select.headerText=M5.G.am.getAsset("assets/selectHeaderText.png");select.separator=M5.G.am.getAsset("assets/separator.png");select.backBtn=new M5.Button(GAME.context,84,340,M5.G.am.getAsset("assets/btBackNormal.png"),M5.G.am.getAsset("assets/btBackDown.png"),function(){M5.World.showScene(start.id)});for(var a=0;3>a;a++)
for(var b=0;4>b;b++){var c=b+4*a;select.btLevels[c]=new M5.Button(GAME.context,25+70*b,78*a+93,M5.G.am.getAsset("assets/levelButtons.png",{x:0,y:54*c,h:54,w:54}),M5.G.am.getAsset("assets/levelButtons.png",{x:54,y:54*c,h:54,w:54}),function(a){return function(){select.startLevel(a)}}
(c),M5.G.am.getAsset("assets/levelButtons.png",{x:108,y:54*c,h:54,w:54}));c>=select.unlockedLevels&&select.btLevels[c].disable()}
GAME.CONTROL.onTouchStart=select.onTouchStart;GAME.CONTROL.onTouchMove=select.onTouchMove;GAME.CONTROL.onTouchEnd=select.onTouchEnd};select.startLevel=function(a){M5.LevelManager.setLevel(a+1);M5.World.showScene(board.id);select.isLeavingScene=!0};select.update=function(){var a=select.btLevels.length;GAME.context.drawImage(select.imgBG,0,0);GAME.context.drawImage(select.headerText,25,18);GAME.context.drawImage(select.separator,10,80);GAME.context.drawImage(select.separator,10,318);for(select.backBtn.draw();a--;)
select.btLevels[a].draw()};select.onExit=function(){GAME.CONTROL.disableInput()};select.onTouchStart=function(a){var b=select.btLevels.length;select.lastMoveEvent=a;for(a=M5.Utils.resolveRelativePositionFromEvent(a);b--;)
select.btLevels[b].onDown(a.x,a.y);select.backBtn.onDown(a.x,a.y)};select.onTouchMove=function(a){select.lastMoveEvent=a};select.onTouchEnd=function(){var a,b=select.btLevels.length;for(a=M5.Utils.resolveRelativePositionFromEvent(select.lastMoveEvent);b--;)
select.btLevels[b].onUp(a.x,a.y);if(!1==select.isLeavingScene)
select.backBtn.onUp(a.x,a.y)};select.repaint=function(){};var start=new M5.Scene;start.bgImg=null;start.playBtn=null;start.lastMovementEvent=null;start.onEnter=function(){start.bmImg=M5.G.am.getAsset("assets/background.png");start.cpyImg=M5.G.am.getAsset("assets/copyright.png");start.logo=M5.G.am.getAsset("assets/logo.png");start.logoRibbon=M5.G.am.getAsset("assets/logoRibbon.png");start.playBtn=new M5.Button(GAME.context,84,232,M5.G.am.getAsset("assets/btPlayNormal.png"),M5.G.am.getAsset("assets/btPlayDown.png"),function(){M5.World.showScene(select.id)});start.moreBtn=new M5.Button(GAME.context,84,302,M5.G.am.getAsset("assets/btMoreNormal.png"),M5.G.am.getAsset("assets/btMoreDown.png"),function(){goHome();});start.camera=new THREE.PerspectiveCamera(75,GAME.WIDTH/GAME.HEIGHT,1,1E4);start.camera.position.y=0;start.camera.position.z=500;start.scene=new THREE.Scene;start.geometry=new THREE.CubeGeometry(180,180,180);start.material=new THREE.MeshBasicMaterial({color:15724527,wireframe:!0});start.mesh=new THREE.Mesh(this.geometry,this.material);start.mesh.position.y=195;start.scene.add(this.mesh);start.renderer=new THREE.CanvasRenderer({devicePixelRatio:1});start.renderer.setSize(GAME.WIDTH,GAME.HEIGHT);GAME.CONTROL.onTouchStart=start.onTouchStart;GAME.CONTROL.onTouchMove=start.onTouchMove;GAME.CONTROL.onTouchEnd=start.onTouchEnd};start.onTouchStart=function(a){start.lastMoveEvent=a;a=M5.Utils.resolveRelativePositionFromEvent(a);start.playBtn.onDown(a.x,a.y);start.moreBtn.onDown(a.x,a.y)};start.onTouchMove=function(a){select.lastMoveEvent=a};start.onTouchEnd=function(){var a;a=M5.Utils.resolveRelativePositionFromEvent(start.lastMoveEvent);start.playBtn.onUp(a.x,a.y);start.moreBtn.onUp(a.x,a.y)};start.update=function(){GAME.context.drawImage(start.bmImg,0,0);GAME.context.drawImage(start.logoRibbon,0,57);start.mesh.rotation.x+=0.005;start.mesh.rotation.y+=0.01;start.renderer.render(start.scene,start.camera);GAME.context.drawImage(start.renderer.domElement,0,0);GAME.context.drawImage(start.logo,32,40);start.playBtn.draw();start.moreBtn.draw();GAME.context.drawImage(start.cpyImg,91,400)};start.repaint=function(){};var GAME={WIDTH:320,HEIGHT:420,canvas:null,context:null,m5:M5,setup:function(){GAME.canvas=document.getElementById("byt_game");GAME.context=GAME.canvas.getContext("2d");document.getElementById("loader_screen").style.setProperty("display","none");GAME.canvas.style.setProperty("display","block");GAME.m5.App.init({resizeFn:GAME.resize});GAME.m5.App.run();M5.World.addScene(start);M5.World.addScene(select);M5.World.addScene(board)},run:function(){M5.World.showScene(start.id);GAME.CONTROL.init()},load:function(){GAME.setup();this.m5.G.am=new AssetManager;this.m5.G.am.queueDownload("assets/background.png");this.m5.G.am.queueDownload("assets/copyright.png");this.m5.G.am.queueDownload("assets/logo.png");this.m5.G.am.queueDownload("assets/logoRibbon.png");this.m5.G.am.queueDownload("assets/btPlayNormal.png");this.m5.G.am.queueDownload("assets/btMoreDown.png");this.m5.G.am.queueDownload("assets/btMoreNormal.png");this.m5.G.am.queueDownload("assets/btPlayDown.png");this.m5.G.am.queueDownload("assets/btBackNormal.png");this.m5.G.am.queueDownload("assets/btBackDisabled.png");this.m5.G.am.queueDownload("assets/btBackDown.png");this.m5.G.am.queueDownload("assets/separator.png");this.m5.G.am.queueDownload("assets/selectHeaderText.png");this.m5.G.am.queueDownload("assets/levelButtons.png");this.m5.G.am.queueDownload("assets/levelLabels.png");this.m5.G.am.queueDownload("assets/labelMixing.png");this.m5.G.am.queueDownload("assets/labelSuper.png");this.m5.G.am.queueDownload("assets/labelCongratulations.png");this.m5.G.am.queueDownload("assets/ingameFrame.png");this.m5.G.am.queueDownload("assets/cell_grid.png");this.m5.G.am.downloadAll(function(){GAME.run()})},CONTROL:{onTouchStart:function(){},onTouchMove:function(){},onTouchEnd:function(){},init:function(){window.addEventListener("mousedown",function(a){a.preventDefault();GAME.CONTROL.onTouchStart(a)},!1);window.addEventListener("touchstart",function(a){/* a.preventDefault(); */GAME.CONTROL.onTouchStart(a)},!1);window.addEventListener("mousemove",function(a){a.preventDefault();GAME.CONTROL.onTouchMove(a)},!1);window.addEventListener("touchmove",function(a){a.preventDefault();GAME.CONTROL.onTouchMove(a)},!1);window.addEventListener("mouseup",function(a){a.preventDefault();GAME.CONTROL.onTouchEnd(a)},!1);window.addEventListener("touchend",function(a){a.preventDefault();GAME.CONTROL.onTouchEnd(a)},!1)},disableInput:function(){this.onTouchStart=function(){};this.onTouchMove=function(){};this.onTouchEnd=function(){}}},resize:function(){GAME.canvas.setAttribute("width",GAME.WIDTH);GAME.canvas.setAttribute("height",GAME.HEIGHT);GAME.m5.App.currentHeight=window.innerHeight;GAME.m5.App.currentWidth=~~(GAME.m5.App.currentHeight*GAME.m5.App.RATIO);GAME.m5.App.currentWidth>window.innerWidth?(GAME.m5.App.currentWidth=window.innerWidth,GAME.m5.App.currentHeight=GAME.m5.App.currentWidth*(GAME.HEIGHT/GAME.WIDTH)|0,GAME.canvas.style.margin=((window.innerHeight-GAME.m5.App.currentHeight)/2|0)+"px auto"):GAME.canvas.style.margin="0px auto";if(GAME.m5.App.DEVICE_IS_ANDROID||GAME.m5.App.DEVICE_IS_IOS)
document.body.style.height=window.innerHeight+50+"px";GAME.canvas.style.width=GAME.m5.App.currentWidth+"px";GAME.canvas.style.height=GAME.m5.App.currentHeight+"px";GAME.m5.App.SCALE=GAME.m5.App.currentWidth/GAME.m5.App.WIDTH;GAME.m5.App.OFFSET.top=GAME.canvas.offsetTop;GAME.m5.App.OFFSET.left=GAME.canvas.offsetLeft;GAME.m5.World.resizeScene();window.setTimeout(function(){window.scrollTo(0,1)},1)}};