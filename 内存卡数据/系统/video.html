<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <link rel="icon" type="image/png"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8DwQMAAFAbQIOMhQIiIAwQAAAABJRU5ErkJggg==" />
    <link rel="stylesheet" href="../系统/CSS/style.css">
    <title>在线影院</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        outline: none;
        border: none;
        text-decoration: none;
        box-sizing: border-box;
    }

    .container {
        width: 700px;
        margin-top: 40px;
        overflow: hidden;
    }

    #videoList li {
        position: relative;
        list-style-type: none;
        background-color: #dfe9f5;
        border-radius: 10px;
        padding: 15px 10px;
        margin-top: 5px;
        margin-bottom: 5px;
        box-sizing: border-box;
    }

    #videoList li a {
        display: inline-block;
        width: 85%;
        padding: 0 0px;
        border-radius: 5px;
        box-sizing: border-box;
    }

    #videoList li:hover {
        background-color: #007bff;
        color: #ffffff;
        cursor: pointer;
    }

    #videoList li:hover .file-size {
        color: inherit;
    }

    .file-size {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        right: 10px;
        color: #666;
        font-size: 0.9em;
    }

    #videoListContainer {
        max-height: 700px;
        overflow-y: auto;
        -ms-overflow-style: none;
        scrollbar-width: none;
        border-radius: 20px;
        background-color: #f9f9f9;
        padding: 10px;
    }

    #videoListContainer::-webkit-scrollbar {
        display: none;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: rgba(0, 0, 0, 0.4);
        position: relative;
        display: flex;
        margin-top: 10%;
        margin-left: 25%;
        min-width: 320px;
        min-height: 240px;
        padding: 0;
    }

    .close {
        position: relative;
        top: 0;
        right: 0;
        font-size: 30px;
        z-index: 1;
        color: #ff69b4
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #videoPlayer {
        position: relative;
        justify-content: center;
    }
</style>

<body>
    <div class="container">
        <section id="videoListContainer">
            <ul id="videoList">
            </ul>
        </section>
    </div>
    <div id="videoModal" class="modal">
        <div class="modal-content">
            <video id="videoPlayer" width="800" height="480" controls preload="metadata"></video>
            <span class="close">&times;</span>
        </div>
    </div>
</body>
<script>
    function storage() {
        fetch('/get_video')
            .then(response => response.json())
            .then(data => {
                displayVideoList(data);
            })
            .catch(error => console.error('Error:', error));
    }
    function displayVideoList(data) {
        const videoList = document.getElementById('videoList');
        videoList.innerHTML = '';

        data.videos.forEach(video => {
            const listItem = document.createElement('li');

            const videoLink = document.createElement('a');
            videoLink.href = '#';

            videoLink.onclick = (e) => {
                e.preventDefault();

                const videoPlayer = document.getElementById('videoPlayer');
                const modal = document.getElementById('videoModal');
                const modalContent = modal.querySelector('.modal-content');

                videoPlayer.src = video.videoPath;
                modal.style.display = 'block';
                modalContent.style.width = `${videoPlayer.offsetWidth}px`;
                modalContent.style.height = `${videoPlayer.offsetHeight}px`;

                const closeButton = modal.querySelector('.close');
                closeButton.onclick = function () {
                    modal.style.display = 'none';
                    videoPlayer.pause();
                    videoPlayer.currentTime = 0;
                    videoPlayer.src = '';
                };
                videoPlayer.play().catch(error => {
                    console.error('播放请求被中断或失败:', error);
                });
            };

            const videoName = video.videoPath.split('/').pop();
            videoLink.appendChild(document.createTextNode(videoName));
            listItem.appendChild(videoLink);

            const fileSizeText = document.createElement('span');
            fileSizeText.textContent = `(${bytesToSize(video.filesize)})`;
            fileSizeText.className = 'file-size';
            listItem.appendChild(fileSizeText);

            videoList.appendChild(listItem);
        });
    }
    function bytesToSize(bytes) {
        var sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
        if (bytes == 0) return '0 B';
        var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
        var size = bytes / Math.pow(1024, i);
        if (sizes[i] !== 'B') {
            size = size.toFixed(2);
        }
        return size + ' ' + sizes[i];
    }
    videoPlayer.onerror = function (event) {
        console.error('视频播放出错:', event.target.error.code);

        // 根据错误类型和实际情况决定是否重试
        if (event.target.error.code === event.target.MEDIA_ERR_ABORTED) { // 用户取消或网络问题
            console.error('用户取消:', event.target.error.code);
            // 可能不需要重试
        } else if (event.target.error.code === event.target.MEDIA_ERR_NETWORK) { // 网络错误
            console.error('网络错误:', event.target.error.code);
        } else if (event.target.error.code === event.target.MEDIA_ERR_SRC_NOT_SUPPORTED) { // 不支持的格式
            alert('视频格式不支持');
        } else {
            console.error('不知道:', event.target.error.code);
            // 其他错误处理
        }
    };

    window.onload = storage;
</script>

</html>